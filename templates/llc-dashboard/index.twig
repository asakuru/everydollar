{% extends "layout.twig" %}

{% block title %}LLC Dashboard - {{ app_name }}{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-white">LLC Dashboard: {{ current_entity.name }}</h1>
            <p class="text-gray-400 text-sm mt-1">Financial overview for {{ current_year }}</p>
        </div>
        <div class="flex space-x-3">
            <a href="{{ base_path('/invoices/create') }}" class="btn btn-primary text-sm">+ New Invoice</a>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Revenue -->
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-sm">
            <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider">YTD Revenue</h3>
            <div class="mt-2 flex items-baseline">
                <span class="text-3xl font-bold text-emerald-400">${{ (revenue_cents / 100)|number_format(2) }}</span>
            </div>
        </div>

        <!-- Expenses -->
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-sm">
            <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider">YTD Expenses</h3>
            <div class="mt-2 flex items-baseline">
                <span class="text-3xl font-bold text-red-400">${{ (expenses_cents / 100)|number_format(2) }}</span>
            </div>
        </div>

        <!-- Profit -->
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-sm">
            <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider">Net Profit</h3>
            <div class="mt-2 flex items-baseline">
                <span class="text-3xl font-bold {% if profit_cents >= 0 %}text-white{% else %}text-red-400{% endif %}">
                    ${{ (profit_cents / 100)|number_format(2) }}
                </span>
            </div>
             <p class="mt-1 text-xs text-gray-500">Margin: {{ ((revenue_cents > 0) ? (profit_cents / revenue_cents * 100) : 0)|number_format(1) }}%</p>
        </div>
    </div>

    <!-- Tax Estimates -->
    <div class="bg-gray-800 rounded-xl border border-gray-700 shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-700 flex justify-between items-center">
             <h2 class="text-lg font-bold text-white">Quarterly Tax Estimates</h2>
             <span class="text-xs bg-gray-700 text-gray-300 py-1 px-2 rounded-full">Rate: {{ tax_rate }}%</span>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                {% for quarter in tax_estimates %}
                <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-700 relative">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-white">{{ quarter.quarter }}</span>
                        <span class="text-xs text-gray-500">Due: {{ quarter.due_date|date('M d') }}</span>
                    </div>
                    
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Profit:</span>
                            <span class="text-gray-300">${{ (quarter.income_cents / 100)|number_format(2) }}</span>
                        </div>
                         <div class="flex justify-between">
                            <span class="text-gray-400">Est. Tax:</span>
                            <span class="text-orange-400">${{ (quarter.estimated_tax_cents / 100)|number_format(2) }}</span>
                        </div>
                         <div class="flex justify-between border-t border-gray-700 pt-1 mt-1">
                            <span class="text-gray-400">Paid:</span>
                            <span class="text-emerald-400">${{ (quarter.paid_cents / 100)|number_format(2) }}</span>
                        </div>
                    </div>

                    {% if quarter.estimated_tax_cents > quarter.paid_cents %}
                    <form action="{{ base_path('/llc-dashboard/record-tax') }}" method="POST" class="mt-3">
                        {{ csrf_field()|raw }}
                        <input type="hidden" name="quarter" value="{{ quarter.quarter }}">
                        <input type="hidden" name="amount" value="{{ (quarter.estimated_tax_cents - quarter.paid_cents) / 100 }}">
                        <button type="submit" class="w-full text-xs bg-gray-700 hover:bg-gray-600 text-white py-1 rounded transition-colors">
                            Mark Paid (${{ ((quarter.estimated_tax_cents - quarter.paid_cents) / 100)|number_format(2) }})
                        </button>
                    </form>
                    {% else %}
                    <div class="mt-3 text-center text-xs text-emerald-500 font-medium py-1">
                        Fully Paid
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Recent Invoices -->
    <div class="bg-gray-800 rounded-xl border border-gray-700 shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-700 flex justify-between items-center">
             <h2 class="text-lg font-bold text-white">Unpaid Invoices</h2>
             <a href="{{ base_path('/invoices') }}" class="text-sm text-emerald-400 hover:text-emerald-300">View All</a>
        </div>
        <table class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gray-900/50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Number</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Client</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Due Date</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">Amount</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
                {% for invoice in unpaid_invoices %}
                <tr class="hover:bg-gray-750">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">#{{ invoice.invoice_number }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ invoice.client_name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ invoice.due_date|date('M d, Y') }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-white">${{ (invoice.amount_cents / 100)|number_format(2) }}</td>
                </tr>
                 {% else %}
                <tr>
                    <td colspan="4" class="px-6 py-8 text-center text-gray-400">No unpaid invoices.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
